# Grex üê¶: Extremely Generic Header-Only SIMD Library for C++20

Grex (Latin ‚Äúfloat, pack, swarm‚Äù) is a header-only C++20 library without external dependencies (the tests have some) developed by Kurt B√∂hm to implement generic SIMD vectorization.
It has two main aims which complement each other:

- Provide generic SIMD vector (and mask) types that make it easy to write a function that can be applied using SIMD vectors with an arbitrary (supported) value type and size, together with a large assortment of useful operations that are implemented with close to ideal efficiency (at least in most cases).
- Provide operations which can be applied either using SIMD vectorization or using scalar values only, allowing functions built upon these operations to achieve the same.

To fulfil the former goal, Grex provides `grex::Vector<Value, size>` and `grex::Mask<Value, size>` (conceptually a vector of Booleans) with a various member and non-member functions that operate using these types.
In addition to many fundamental operations, such as arithmetic and bit-wise operations, element insertion and extraction, horizontal addition and minimum/maximum, and many others, Grex also provides a full complement of type conversion operations (including those for which no instruction exists on x86-64 until AVX-512) as well as shuffle and blend operations whose behaviour is specified at compile time, with a fancy mechanism to choose the most efficient implementation for the desired behaviour.
The implementation of many operations is based on the assembly code generated by Clang at high optimization levels (which optimizes SIMD code much more effectively than GCC in most cases), and a few are inspired by the implementation in the [Vector Class Library](https://github.com/vectorclass/version2).

The latter goal is fulfilled by implementing operations that are overloaded to support vector or scalar arguments or, when required, have an additional argument of an empty _tag_ type which encodes the desired behaviour at compile-time.
Grex provides tag types such as `grex::ScalarTag`, `grex::FullTag<size>`, and `grex::PartTag<size>` that cover many common use cases and are supported by the operations which take a tag as an argument.

Grex is split into two abstraction levels:
The _high level_, which has been described so far, and the _backend_, which provides the implementation for the types and operations used on the high level in a less user-friendly fashion.
The main goal of this separation is to allow for the transparent implementation of different backends for different ISAs without implementing the high level repeatedly, as well as the ability to disable all backends to support platforms for which no backend has been implemented.
However, this goal is not fully realized yet.

## Future Work

Currently, Grex only supports x86-64 processors (support for 32-bit x86 processors is not planned, as those are too old to be relevant in contemporaneous high-performance applications).
While support for ARM NEON is a medium-term goal, the main short-term goal is to support using Grex on platforms for which no vectorized backend is present (i.e. everything but x86-64 at the moment) by avoiding the inclusion of the platform-specific headers.

## Building

Grex uses the Meson build system and includes a very extensive set of tests.
These can be run by executing `meson setup -C <build directory>` followed by `meson test -C <build directory>`.
`Makefile` contains targets for calling `meson setup` with different optimization and debug settings.

## Dependencies

Grex itself does not have any dependencies!
The dependencies of the tests are handled using Meson subprojects, which make it possible to use the tests without installing any packages.
The Meson subprojects are managed by [Tlaxcaltin](https://github.com/KurtBoehm/tlaxcaltin) and are:

- [Thesauros](https://github.com/KurtBoehm/thesauros): Many basic components, from data structures to threading utilities to static ranges and many other things.
- [`{fmt}`](https://github.com/fmtlib/fmt): String formatting and printing.
- [`pcg-cpp`](https://github.com/imneme/pcg-cpp.git): Efficient and high-quality pseudo-random number generation.
- [`options`](https://github.com/KurtBoehm/tlaxcaltin/blob/main/options/meson.build): Compiler options to enable more warnings and optimization settings.

## Licences

Grex is licensed under the terms of the Mozilla Public Licence 2.0, which is provided in [`License`](License).
The file [`test/rng.hpp`](test/rng.hpp) is based on [https://github.com/imneme/pcg-c-basic/blob/master/pcg_basic.c](https://github.com/imneme/pcg-c-basic/blob/master/pcg_basic.c), which is licensed under the Apache Licence, Version 2.0, as provided in [`test/pcg-license`](test/pcg-license).
