// This file is part of https://github.com/KurtBoehm/grex.
//
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at https://mozilla.org/MPL/2.0/.

#ifndef INCLUDE_GREX_BACKEND_NEON_OPERATIONS_REINTERPRET_HPP
#define INCLUDE_GREX_BACKEND_NEON_OPERATIONS_REINTERPRET_HPP

#include <cstddef>

#include <arm_neon.h>

#include "grex/backend/neon/macros/types.hpp"
#include "grex/base/defs.hpp"

namespace grex::backend {
#define GREX_REINTERPRET_DEFAULT(DSTKIND, DSTBITS, DSTSIZE, SRCKIND, SRCBITS, SRCSIZE) \
  inline GREX_REGISTER(DSTKIND, DSTBITS, DSTSIZE) \
    reinterpret(GREX_REGISTER(SRCKIND, SRCBITS, SRCSIZE) v, \
                TypeTag<GREX_REGISTER(DSTKIND, DSTBITS, DSTSIZE)>) { \
    return GREX_CAT(vreinterpretq_, GREX_ISUFFIX(DSTKIND, DSTBITS), _, \
                    GREX_ISUFFIX(SRCKIND, SRCBITS))(v); \
  }
#define GREX_REINTERPRET_NOOP(DSTKIND, DSTBITS, DSTSIZE, SRCKIND, SRCBITS, SRCSIZE) \
  inline GREX_REGISTER(DSTKIND, DSTBITS, DSTSIZE) \
    reinterpret(GREX_REGISTER(SRCKIND, SRCBITS, SRCSIZE) v, \
                TypeTag<GREX_REGISTER(DSTKIND, DSTBITS, DSTSIZE)>) { \
    return v; \
  }

// f64
GREX_REINTERPRET_NOOP(f, 64, 2, f, 64, 2)
GREX_REINTERPRET_DEFAULT(f, 64, 2, f, 32, 4)
GREX_REINTERPRET_DEFAULT(f, 64, 2, i, 64, 2)
GREX_REINTERPRET_DEFAULT(f, 64, 2, i, 32, 4)
GREX_REINTERPRET_DEFAULT(f, 64, 2, i, 16, 8)
GREX_REINTERPRET_DEFAULT(f, 64, 2, i, 8, 16)
GREX_REINTERPRET_DEFAULT(f, 64, 2, u, 64, 2)
GREX_REINTERPRET_DEFAULT(f, 64, 2, u, 32, 4)
GREX_REINTERPRET_DEFAULT(f, 64, 2, u, 16, 8)
GREX_REINTERPRET_DEFAULT(f, 64, 2, u, 8, 16)
// f32
GREX_REINTERPRET_DEFAULT(f, 32, 4, f, 64, 2)
GREX_REINTERPRET_NOOP(f, 32, 4, f, 32, 4)
GREX_REINTERPRET_DEFAULT(f, 32, 4, i, 64, 2)
GREX_REINTERPRET_DEFAULT(f, 32, 4, i, 32, 4)
GREX_REINTERPRET_DEFAULT(f, 32, 4, i, 16, 8)
GREX_REINTERPRET_DEFAULT(f, 32, 4, i, 8, 16)
GREX_REINTERPRET_DEFAULT(f, 32, 4, u, 64, 2)
GREX_REINTERPRET_DEFAULT(f, 32, 4, u, 32, 4)
GREX_REINTERPRET_DEFAULT(f, 32, 4, u, 16, 8)
GREX_REINTERPRET_DEFAULT(f, 32, 4, u, 8, 16)

// i64
GREX_REINTERPRET_DEFAULT(i, 64, 2, f, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 64, 2, f, 32, 4)
GREX_REINTERPRET_NOOP(i, 64, 2, i, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 64, 2, i, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 64, 2, i, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 64, 2, i, 8, 16)
GREX_REINTERPRET_DEFAULT(i, 64, 2, u, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 64, 2, u, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 64, 2, u, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 64, 2, u, 8, 16)
// i32
GREX_REINTERPRET_DEFAULT(i, 32, 4, f, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 32, 4, f, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 32, 4, i, 64, 2)
GREX_REINTERPRET_NOOP(i, 32, 4, i, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 32, 4, i, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 32, 4, i, 8, 16)
GREX_REINTERPRET_DEFAULT(i, 32, 4, u, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 32, 4, u, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 32, 4, u, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 32, 4, u, 8, 16)
// i16
GREX_REINTERPRET_DEFAULT(i, 16, 8, f, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 16, 8, f, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 16, 8, i, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 16, 8, i, 32, 4)
GREX_REINTERPRET_NOOP(i, 16, 8, i, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 16, 8, i, 8, 16)
GREX_REINTERPRET_DEFAULT(i, 16, 8, u, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 16, 8, u, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 16, 8, u, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 16, 8, u, 8, 16)
// i8
GREX_REINTERPRET_DEFAULT(i, 8, 16, f, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 8, 16, f, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 8, 16, i, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 8, 16, i, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 8, 16, i, 16, 8)
GREX_REINTERPRET_NOOP(i, 8, 16, i, 8, 16)
GREX_REINTERPRET_DEFAULT(i, 8, 16, u, 64, 2)
GREX_REINTERPRET_DEFAULT(i, 8, 16, u, 32, 4)
GREX_REINTERPRET_DEFAULT(i, 8, 16, u, 16, 8)
GREX_REINTERPRET_DEFAULT(i, 8, 16, u, 8, 16)

// u64
GREX_REINTERPRET_DEFAULT(u, 64, 2, f, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 64, 2, f, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 64, 2, i, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 64, 2, i, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 64, 2, i, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 64, 2, i, 8, 16)
GREX_REINTERPRET_NOOP(u, 64, 2, u, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 64, 2, u, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 64, 2, u, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 64, 2, u, 8, 16)
// u32
GREX_REINTERPRET_DEFAULT(u, 32, 4, f, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 32, 4, f, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 32, 4, i, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 32, 4, i, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 32, 4, i, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 32, 4, i, 8, 16)
GREX_REINTERPRET_DEFAULT(u, 32, 4, u, 64, 2)
GREX_REINTERPRET_NOOP(u, 32, 4, u, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 32, 4, u, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 32, 4, u, 8, 16)
// u16
GREX_REINTERPRET_DEFAULT(u, 16, 8, f, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 16, 8, f, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 16, 8, i, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 16, 8, i, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 16, 8, i, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 16, 8, i, 8, 16)
GREX_REINTERPRET_DEFAULT(u, 16, 8, u, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 16, 8, u, 32, 4)
GREX_REINTERPRET_NOOP(u, 16, 8, u, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 16, 8, u, 8, 16)
// u8
GREX_REINTERPRET_DEFAULT(u, 8, 16, f, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 8, 16, f, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 8, 16, i, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 8, 16, i, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 8, 16, i, 16, 8)
GREX_REINTERPRET_DEFAULT(u, 8, 16, i, 8, 16)
GREX_REINTERPRET_DEFAULT(u, 8, 16, u, 64, 2)
GREX_REINTERPRET_DEFAULT(u, 8, 16, u, 32, 4)
GREX_REINTERPRET_DEFAULT(u, 8, 16, u, 16, 8)
GREX_REINTERPRET_NOOP(u, 8, 16, u, 8, 16)

template<typename TDst, typename TSrc>
inline TDst reinterpret(TSrc src) {
  return reinterpret(src, type_tag<TDst>);
}
} // namespace grex::backend

#endif // INCLUDE_GREX_BACKEND_NEON_OPERATIONS_REINTERPRET_HPP
